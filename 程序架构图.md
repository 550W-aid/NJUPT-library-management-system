# 图书管理系统 - 程序架构图

## 🏗️ 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                    图书管理系统架构                          │
├─────────────────────────────────────────────────────────────┤
│  📱 用户界面层 (View Layer)                                 │
│  ├── MainWindow (主窗口)                                   │
│  │   ├── 数据表格显示                                      │
│  │   ├── 菜单栏操作                                        │
│  │   ├── 搜索栏功能                                        │
│  │   └── 主题切换按钮                                      │
│  ├── BookDialog (图书编辑对话框)                           │
│  ├── LoginDialog (登录对话框)                              │
│  └── SplashScreen (启动画面)                               │
├─────────────────────────────────────────────────────────────┤
│  🎮 控制逻辑层 (Controller Layer)                          │
│  └── MainWindow 控制器                                     │
│      ├── 用户交互处理                                      │
│      ├── 权限控制管理                                      │
│      ├── 界面状态更新                                      │
│      └── 业务逻辑协调                                      │
├─────────────────────────────────────────────────────────────┤
│  💾 数据模型层 (Model Layer)                               │
│  ├── Book (图书数据结构)                                   │
│  │   ├── indexId (索引号)                                  │
│  │   ├── name (名称)                                       │
│  │   ├── location (馆藏地址)                               │
│  │   ├── category (类别)                                   │
│  │   ├── quantity (数量)                                    │
│  │   ├── price (价格)                                      │
│  │   ├── inDate (入库日期)                                 │
│  │   ├── returnDate (归还日期)                             │
│  │   ├── borrowCount (借阅次数)                            │
│  │   └── available (可借状态)                              │
│  └── LibraryManager (图书管理核心)                         │
│      ├── 数据存储管理                                      │
│      ├── CRUD操作                                          │
│      ├── 业务逻辑处理                                      │
│      ├── 查询筛选功能                                      │
│      ├── 排序统计功能                                      │
│      └── 文件I/O操作                                       │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 程序执行流程

```
程序启动
    │
    ▼
┌─────────────┐
│ main() 入口 │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│SplashScreen │ ──→ 启动动画
│启动画面     │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│LoginDialog  │ ──→ 用户登录验证
│登录对话框   │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│MainWindow   │ ──→ 主程序界面
│主窗口       │
└─────────────┘
```

## 📊 数据流图

```
用户操作
    │
    ▼
┌─────────────┐
│MainWindow   │ ──→ 界面交互处理
│界面控制     │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│LibraryManager│ ──→ 业务逻辑处理
│数据管理     │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│Book 数据结构│ ──→ 数据存储
│内存数据     │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│JSON 文件    │ ──→ 数据持久化
│磁盘存储     │
└─────────────┘
```

## 🎯 核心功能模块

### 1. 数据管理模块 (LibraryManager)

```
LibraryManager
├── 基本操作
│   ├── addBook() - 添加图书
│   ├── removeBook() - 删除图书
│   ├── updateBook() - 更新图书
│   └── findByName() - 查找图书
├── 业务逻辑
│   ├── borrowBook() - 借阅图书
│   └── returnBook() - 归还图书
├── 查询筛选
│   ├── getByCategory() - 按分类筛选
│   ├── getByLocation() - 按位置筛选
│   ├── getAvailable() - 获取可借图书
│   ├── getBorrowed() - 获取已借图书
│   └── searchBooks() - 关键词搜索
├── 排序功能
│   ├── sortByName() - 按名称排序
│   ├── sortByCategory() - 按分类排序
│   ├── sortByPrice() - 按价格排序
│   └── sortByBorrowCount() - 按借阅次数排序
├── 统计功能
│   ├── getTotalBooks() - 获取图书总数
│   ├── getTotalValue() - 计算图书总价值
│   └── getMostPopularCategory() - 获取最热门分类
└── 文件操作
    ├── loadFromFile() - 从文件加载数据
    └── saveToFile() - 保存数据到文件
```

### 2. 界面控制模块 (MainWindow)

```
MainWindow
├── 界面初始化
│   ├── setupTable() - 设置数据表格
│   ├── setupMenuBar() - 设置菜单栏
│   ├── setupSearchBar() - 设置搜索栏
│   ├── setupThemeToggle() - 设置主题切换
│   └── initializeSampleBooks() - 初始化示例数据
├── 用户交互处理
│   ├── onAdd() - 处理添加图书
│   ├── onEdit() - 处理编辑图书
│   ├── onRemove() - 处理删除图书
│   ├── onBorrow() - 处理借阅操作
│   ├── onReturn() - 处理归还操作
│   └── onSearch() - 处理搜索操作
├── 权限管理
│   ├── setUserMode() - 设置用户模式
│   ├── setCurrentUser() - 设置当前用户
│   └── updateUIForUserMode() - 更新界面权限
└── 主题系统
    ├── toggleTheme() - 切换主题
    ├── applyTheme() - 应用主题
    └── getThemeStyles() - 获取主题样式
```

### 3. 对话框模块

```
对话框系统
├── BookDialog (图书编辑)
│   ├── setBook() - 设置图书数据
│   └── getBook() - 获取图书数据
├── LoginDialog (登录验证)
│   ├── onLogin() - 处理登录
│   ├── validateCredentials() - 验证用户凭据
│   └── validateAdminPassword() - 验证管理员密码
└── SplashScreen (启动画面)
    ├── showSplash() - 显示启动画面
    ├── fadeIn() - 淡入动画
    └── fadeOut() - 淡出动画
```

## 🔐 权限控制系统

```
用户模式
├── 读者模式 (Reader Mode)
│   ├── ✅ 查看图书信息
│   ├── ✅ 借阅图书
│   ├── ✅ 归还图书
│   ├── ✅ 搜索图书
│   ├── ✅ 查看统计信息
│   ├── ❌ 添加图书
│   ├── ❌ 编辑图书
│   └── ❌ 删除图书
└── 管理员模式 (Admin Mode)
    ├── ✅ 拥有所有读者权限
    ├── ✅ 添加新图书
    ├── ✅ 编辑图书信息
    ├── ✅ 删除图书
    └── 🔐 需要管理员密码验证
```

## 🎨 主题系统

```
主题切换
├── 浅色模式 (Light Mode)
│   ├── 背景色: #F2F2F7
│   ├── 文本色: #1C1C1E
│   ├── 边框色: #E5E5EA
│   └── 强调色: #007AFF
└── 深色模式 (Dark Mode)
    ├── 背景色: #1C1C1E
    ├── 文本色: #FFFFFF
    ├── 边框色: #3A3A3C
    └── 强调色: #007AFF
```

## 📁 文件结构

```
项目根目录
├── main.cpp                 # 程序入口
├── mainwindow.h/cpp         # 主窗口类 (1400+行)
├── librarymanager.h/cpp     # 图书管理核心类
├── book.h                   # 图书数据结构
├── bookdialog.h/cpp        # 图书编辑对话框
├── logindialog.h/cpp       # 登录对话框
├── splashscreen.h/cpp      # 启动画面
├── mainwindow.ui           # 主窗口UI设计文件
├── resources.qrc           # 资源文件
├── icons/                   # 图标资源
│   └── library.svg         # 图书馆图标
└── build/                  # 编译输出目录
    └── untitled.exe        # 可执行文件
```

---

*这个架构图展示了图书管理系统的完整结构，帮助理解程序的整体设计和各模块之间的关系。*
