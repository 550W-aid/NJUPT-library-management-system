# 图书管理系统流程图

## 系统概述

这是一个基于Qt框架开发的图书管理系统，支持图书的增删改查、借阅归还、数据统计等功能，具有管理员和读者两种用户模式。

## 模块化流程图

### 1. 系统启动与登录模块

```mermaid
graph TD
    A[程序启动] --> B[创建QApplication]
    B --> C[显示启动界面 SplashScreen]
    C --> D[启动动画播放]
    D --> E[显示登录对话框 LoginDialog]
    E --> F{用户输入验证}
    F -->|验证成功| G[设置用户模式]
    F -->|验证失败| H[显示错误信息]
    H --> E
    G --> I[创建主窗口 MainWindow]
    I --> J[初始化系统]
    
    style A fill:#e3f2fd
    style C fill:#fff3e0
    style E fill:#f3e5f5
    style G fill:#e8f5e8
    style I fill:#ffebee
```

### 2. 用户权限管理模块

```mermaid
graph TD
    A[用户登录] --> B{用户模式选择}
    B -->|管理员模式| C[管理员界面]
    B -->|读者模式| D[读者界面]
    
    C --> E[完整功能权限]
    C --> F[图书增删改查]
    C --> G[借阅管理]
    C --> H[数据统计]
    
    D --> I[查询功能权限]
    D --> J[图书搜索]
    D --> K[借阅操作]
    D --> L[信息查看]
    
    E --> M[界面权限控制]
    F --> M
    G --> M
    H --> M
    I --> M
    J --> M
    K --> M
    L --> M
    
    M --> N[更新界面状态]
    N --> O[显示/隐藏功能按钮]
    
    style A fill:#e3f2fd
    style C fill:#ffebee
    style D fill:#e8f5e8
    style M fill:#fff3e0
```

### 3. 图书管理核心模块

```mermaid
graph TD
    A[图书管理操作] --> B{操作类型}
    B -->|新增| C[BookDialog输入]
    B -->|编辑| D[加载现有数据]
    B -->|删除| E[确认删除对话框]
    B -->|借阅| F[输入归还日期]
    B -->|归还| G[确认归还操作]
    
    C --> H[数据验证]
    D --> H
    E --> I[删除确认]
    F --> J[借阅处理]
    G --> K[归还处理]
    
    H --> L[LibraryManager处理]
    I --> L
    J --> L
    K --> L
    
    L --> M[Book数据结构]
    M --> N[JSON文件存储]
    L --> O[更新界面显示]
    
    style A fill:#e3f2fd
    style L fill:#fff3e0
    style M fill:#f3e5f5
    style N fill:#fce4ec
```

### 4. 查询筛选模块

```mermaid
graph TD
    A[查询筛选操作] --> B{查询类型}
    B -->|搜索| C[关键词搜索]
    B -->|分类筛选| D[按分类筛选]
    B -->|位置筛选| E[按位置筛选]
    B -->|状态筛选| F[按借阅状态筛选]
    B -->|价格筛选| G[按价格范围筛选]
    
    C --> H[LibraryManager.searchBooks]
    D --> I[LibraryManager.getByCategory]
    E --> J[LibraryManager.getByLocation]
    F --> K[LibraryManager.getAvailable/getBorrowed]
    G --> L[LibraryManager.getExpensiveBooks/getCheapBooks]
    
    H --> M[返回搜索结果]
    I --> M
    J --> M
    K --> M
    L --> M
    
    M --> N[刷新表格显示]
    N --> O[更新状态栏信息]
    
    style A fill:#e3f2fd
    style H fill:#fff3e0
    style I fill:#fff3e0
    style J fill:#fff3e0
    style K fill:#fff3e0
    style L fill:#fff3e0
    style M fill:#e8f5e8
```

### 5. 排序功能模块

```mermaid
graph TD
    A[排序操作] --> B{排序类型}
    B -->|按名称| C[sortByName]
    B -->|按分类| D[sortByCategory]
    B -->|按位置| E[sortByLocation]
    B -->|按价格| F[sortByPrice]
    B -->|按日期| G[sortByDate]
    B -->|按借阅次数| H[sortByBorrowCount]
    
    C --> I[LibraryManager排序处理]
    D --> I
    E --> I
    F --> I
    G --> I
    H --> I
    
    I --> J[更新Book向量排序]
    J --> K[刷新表格显示]
    K --> L[显示排序结果]
    
    style A fill:#e3f2fd
    style I fill:#fff3e0
    style J fill:#f3e5f5
    style K fill:#e8f5e8
```

### 6. 数据管理模块

```mermaid
graph TD
    A[数据管理操作] --> B{操作类型}
    B -->|打开文件| C[选择JSON文件]
    B -->|保存文件| D[选择保存路径]
    B -->|导入数据| E[选择导入文件]
    B -->|导出数据| F[选择导出路径]
    B -->|备份数据| G[自动生成备份文件]
    B -->|恢复数据| H[选择备份文件]
    B -->|统计信息| I[计算统计数据]
    
    C --> J[LibraryManager.loadFromFile]
    D --> K[LibraryManager.saveToFile]
    E --> J
    F --> K
    G --> K
    H --> J
    I --> L[计算统计结果]
    
    J --> M[加载数据到内存]
    K --> N[保存数据到文件]
    L --> O[显示统计信息]
    
    M --> P[刷新界面显示]
    N --> Q[显示保存成功]
    O --> R[弹出统计对话框]
    
    style A fill:#e3f2fd
    style J fill:#fff3e0
    style K fill:#fff3e0
    style L fill:#f3e5f5
    style M fill:#e8f5e8
    style N fill:#e8f5e8
```

### 7. 界面更新模块

```mermaid
graph TD
    A[数据变更] --> B[LibraryManager处理]
    B --> C[更新Book数据结构]
    C --> D[触发界面更新]
    
    D --> E[刷新表格数据]
    E --> F[更新QTableView显示]
    F --> G[重新渲染表格]
    
    D --> H[更新状态栏信息]
    H --> I[计算统计信息]
    I --> J[显示用户信息]
    J --> K[显示图书统计]
    
    D --> L[更新菜单权限]
    L --> M[启用/禁用功能按钮]
    M --> N[更新界面状态]
    
    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style E fill:#e8f5e8
    style H fill:#ffebee
```

### 8. 模块间关系图

```mermaid
graph LR
    A[系统启动模块] --> B[用户权限模块]
    B --> C[图书管理模块]
    B --> D[查询筛选模块]
    B --> E[排序功能模块]
    B --> F[数据管理模块]
    
    C --> G[界面更新模块]
    D --> G
    E --> G
    F --> G
    
    C --> H[LibraryManager]
    D --> H
    E --> H
    F --> H
    
    H --> I[Book数据结构]
    I --> J[JSON文件存储]
    
    style A fill:#e3f2fd
    style B fill:#ffebee
    style C fill:#fff3e0
    style D fill:#fff3e0
    style E fill:#fff3e0
    style F fill:#fff3e0
    style G fill:#e8f5e8
    style H fill:#f3e5f5
    style I fill:#fce4ec
```

## 主要组件说明

### 1. 核心类结构
- **MainWindow**: 主窗口类，负责界面展示和用户交互
- **LibraryManager**: 图书管理核心类，处理所有业务逻辑
- **Book**: 图书数据结构
- **BookDialog**: 图书编辑对话框
- **LoginDialog**: 登录对话框
- **SplashScreen**: 启动界面

### 2. 功能模块

#### 图书管理模块
- 新增图书：通过BookDialog输入图书信息
- 编辑图书：修改现有图书信息
- 删除图书：删除指定图书
- 借阅管理：处理图书借阅和归还

#### 查询筛选模块
- 搜索功能：支持按书名、分类、位置、索引号搜索
- 筛选功能：按分类、位置、状态筛选
- 排序功能：按名称、价格、日期、借阅次数排序

#### 数据管理模块
- 文件操作：打开、保存JSON文件
- 数据导入导出：支持数据备份和恢复
- 统计信息：显示图书统计和热门分类

### 3. 用户权限

#### 管理员模式
- 完整的图书管理权限
- 可以增删改查图书
- 可以管理借阅状态
- 访问所有功能模块

#### 读者模式
- 只能查询和借阅图书
- 无法编辑或删除图书
- 限制部分管理功能

### 4. 数据流程

1. **用户操作** → MainWindow接收用户输入
2. **业务处理** → LibraryManager处理业务逻辑
3. **数据存储** → Book数据结构 → JSON文件持久化
4. **界面更新** → 刷新表格显示 → 更新状态栏信息

## 技术特点

- **界面框架**: Qt6 + C++
- **数据存储**: JSON格式文件
- **主题支持**: 深色/浅色主题切换
- **权限管理**: 管理员/读者双模式
- **用户体验**: 现代化UI设计，支持动画效果

## 系统优势

1. **模块化设计**: 界面与业务逻辑分离
2. **数据安全**: 支持数据备份和恢复
3. **用户友好**: 直观的操作界面和丰富的功能
4. **扩展性强**: 易于添加新功能和模块
5. **跨平台**: 基于Qt框架，支持多平台部署

## 模块化设计的优势

通过将系统分解为7个独立的功能模块，每个模块都有明确的职责：

1. **系统启动与登录模块**: 负责程序初始化和用户认证
2. **用户权限管理模块**: 控制不同用户的功能访问权限
3. **图书管理核心模块**: 处理图书的增删改查和借阅归还
4. **查询筛选模块**: 提供多种查询和筛选功能
5. **排序功能模块**: 支持多种排序方式
6. **数据管理模块**: 处理数据的导入导出和备份恢复
7. **界面更新模块**: 负责界面的实时更新和状态同步

这种模块化设计使得系统更加清晰、易于维护和扩展。
